services:

  app-factorial-api:
    image: "node:16.16-alpine"
    volumes:
      - "./app-factorial-api:/app"
    ports:
      - "3000:3000"
    working_dir: "/app"
    user: "${UID:-1000}:${GID:-1000}"
    entrypoint: ["npm"]
    command: ["start"]
    environment:
      PORT: "3000"
      RABBITMQ_HOST: "rabbitmq"
      RABBITMQ_PORT: "5672"
      RABBITMQ_USERNAME: "admin"
      RABBITMQ_PASSWORD: "123456"

  app-factorial-worker:
    image: "node:16.16-alpine"
    volumes:
      - "./app-factorial-worker:/app"
    working_dir: "/app"
    user: "${UID:-1000}:${GID:-1000}"
    entrypoint: ["npm"]
    command: ["start"]
    environment:
      RABBITMQ_HOST: "rabbitmq"
      RABBITMQ_PORT: "5672"
      RABBITMQ_USERNAME: "admin"
      RABBITMQ_PASSWORD: "123456"
      AWS_ACCESS_KEY_ID: "AKIAIOSFODNN7EXAMPLE"
      AWS_SECRET_ACCESS_KEY: "wJalrXUtnFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY"
      AWS_ENDPOINT: "http://minio:9000"

  rabbitmq:
    image: "rabbitmq:3.10-management"
    ports:
      - "5672:5672"
      - "15672:15672"
    environment:
      RABBITMQ_DEFAULT_USER: "admin"
      RABBITMQ_DEFAULT_PASS: "123456"

  minio:
    image: "minio/minio"
    volumes:
      - "minio-data:/data"
    ports:
      - "9000:9000"
      - "9001:9001"
    entrypoint: ["minio"]
    command: ["server", "/data", "--console-address", ":9001"]
    environment:
      MINIO_ROOT_USER: "AKIAIOSFODNN7EXAMPLE"
      MINIO_ROOT_PASSWORD: "wJalrXUtnFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY"

volumes:
  minio-data:
